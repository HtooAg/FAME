"use strict";(()=>{var e={id:8788,ids:[8788]};e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},11932:e=>{e.exports=import("@google-cloud/storage")},85547:(e,t,r)=>{r.a(e,(async(e,o)=>{try{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>y,requestAsyncStorage:()=>g,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p});var n=r(73278),s=r(45002),a=r(54877),i=r(74232),u=e([i]);i=(u.then?(await u)():u)[0];const d="",l=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/auth/me/route",pathname:"/api/auth/me",filename:"route",bundlePath:"app/api/auth/me/route"},resolvedPagePath:"C:\\Users\\ASUS\\Downloads\\fame-event-manager\\app\\api\\auth\\me\\route.ts",nextConfigOutput:d,userland:i}),{requestAsyncStorage:g,staticGenerationAsyncStorage:p,serverHooks:m}=l,f="/api/auth/me/route";function y(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}o()}catch(c){o(c)}}))},74232:(e,t,r)=>{r.a(e,(async(e,o)=>{try{r.r(t),r.d(t,{GET:()=>g,dynamic:()=>l});var n=r(71309),s=r(67390),a=r.n(s),i=r(45824),u=e([i]);i=(u.then?(await u)():u)[0];const d=process.env.JWT_SECRET||"dev-secret-do-not-use-in-prod",l="force-dynamic";async function g(e){try{const t=e.cookies.get("auth-token")?.value;if(!t)return n.NextResponse.json({error:"No token"},{status:401});const r=a().verify(t,d),o=await(0,i.gn)(i.Hb.usersIndex,[]);let s=o.find((e=>e.id===r.userId));if(console.log("User lookup result:",{userId:r.userId,found:!!s}),"super_admin"===r.role){const e=o.find((e=>"super_admin"===e.role&&e.id===r.userId));if(e)return n.NextResponse.json({id:e.id,email:e.email,name:e.name,role:"super_admin",accountStatus:"active",subscriptionStatus:"active"})}if(!s){s=(await(0,i.Dw)(i.Hb.registrationStageManagerDir)).find((e=>e.id===r.userId)),console.log("Registration lookup result:",{userId:r.userId,found:!!s})}if(!s)return n.NextResponse.json({error:"User not found"},{status:404});if("super_admin"!==s.role){if("suspended"===s.accountStatus)return n.NextResponse.json({error:"Account suspended",accountStatus:"suspended"},{status:403});if("deactivated"===s.accountStatus)return n.NextResponse.json({error:"Account deactivated",accountStatus:"deactivated"},{status:403});if("rejected"===s.accountStatus)return n.NextResponse.json({error:"Account rejected",accountStatus:"rejected"},{status:403});s.accountStatus}return n.NextResponse.json({id:s.id,email:s.email,name:s.name,role:s.role,eventId:s.eventId,accountStatus:s.accountStatus,subscriptionStatus:s.subscriptionStatus,subscriptionEndDate:s.subscriptionEndDate})}catch(t){return console.error("Me error:",t),n.NextResponse.json({error:"Invalid token"},{status:401})}}o()}catch(c){o(c)}}))},45824:(e,t,r)=>{r.a(e,(async(e,o)=>{try{r.d(t,{BX:()=>g,Dw:()=>l,Hb:()=>i,au:()=>d,gn:()=>c});var n=r(33425),s=e([n]);n=(s.then?(await s)():s)[0];const i={usersIndex:"users/index.json",registrationStageManagerDir:"registrations/stage-managers",registrationArtistDir:"registrations/artists",eventsIndex:"events/index.json",stageManagersIndex:"stage-managers/index.json",superAdminsIndex:"super-admins/index.json",globalArtistsIndex:"artists/index.json",stageManagerCounter:"counters/stage-manager.json",userByRole:(e,t)=>`users/${e}/${t}.json`,registrationStageManagerFile:(e,t)=>`registrations/stage-managers/${e}-${t}.json`,registrationArtistFile:(e,t)=>`registrations/artists/${e}-${t}.json`,eventFile:e=>`events/${e}.json`,artistFile:e=>`artists/${e}.json`,artistsIndex:e=>`events/${e}/artists/index.json`,stageManagerFile:e=>`stage-managers/${e}.json`,emergencyActive:e=>`events/${e}/emergency/active.json`,emergencyLogDir:e=>`events/${e}/emergency/logs`,emergencyLogFile:(e,t)=>`events/${e}/emergency/logs/${t}.json`};class u{constructor(e="artist-event-storage"){this.bucketName=e}async uploadFile(e,t,r){try{const o=Date.now(),s=Math.random().toString(36).substring(2,9),a=`${o}_${s}.${e.name.split(".").pop()}`,i=await e.arrayBuffer(),u=Buffer.from(i),c=await n.Z.uploadFile(u,a,`${t}/${r}`,e.type);return{url:c.url,filename:c.filename,size:e.size,contentType:e.type}}catch(o){throw console.error("Error uploading file to Google Cloud Storage:",o),new Error("Failed to upload file to Google Cloud Storage")}}async uploadFiles(e,t,r){const o=e.map((e=>this.uploadFile(e,t,r)));return Promise.all(o)}async deleteFile(e){try{await n.Z.deleteFile(e)}catch(t){throw console.error("Error deleting file from Google Cloud Storage:",t),new Error("Failed to delete file from Google Cloud Storage")}}async getSignedUrl(e,t=3600){try{return await n.Z.getSignedUrl(e,t)}catch(r){throw console.error("Error generating signed URL from Google Cloud Storage:",r),new Error("Failed to generate signed URL from Google Cloud Storage")}}}new u;async function c(e,t=null){try{const r=await n.Z.readJSON(e);return null!==r?r:t}catch(r){return console.error("Error reading JSON file from Google Cloud Storage:",r),t}}async function d(e,t){try{await n.Z.saveJSON(t,e)}catch(r){throw console.error("Error writing JSON file to Google Cloud Storage:",r),new Error("Failed to write JSON file to Google Cloud Storage")}}async function l(e){try{const t=(await n.Z.listFiles(e)).filter((e=>e.endsWith(".json"))),r=[];for(const e of t){const t=await n.Z.readJSON(e);null!==t&&r.push(t)}return r}catch(t){return console.error("Error reading JSON directory from Google Cloud Storage:",t),[]}}async function g(e,t,r="id"){try{const o=await c(e,[])||[],n=o.findIndex((e=>e[r]===t[r]));n>=0?o[n]={...o[n],...t}:o.push(t),await d(e,o)}catch(o){throw console.error("Error upserting array file:",o),new Error("Failed to upsert array file")}}o()}catch(a){o(a)}}))}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=t.X(0,[9379,4833,7390,3425],(()=>{return e=85547,t(t.s=e);var e}));module.exports=r})();